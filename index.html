<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pedir por WhatsApp</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #e5ddd5;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .chat-container {
      width: 95%;
      max-width: 450px;
      height: 88vh;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
    }

    .chat-header {
      background-color: #075e54;
      color: white;
      padding: 15px;
      text-align: center;
      font-weight: bold;
      border-top-left-radius: 10px;
      border-top-right-radius: 10px;
    }

    .chat-messages {
      flex: 1;
      padding: 15px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    .message {
      max-width: 80%;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 10px;
      word-wrap: break-word;
      line-height: 1.4;
    }

    .bot {
      background-color: #e0e0e0;
      align-self: flex-start;
      border-bottom-left-radius: 0;
    }

    .user {
      background-color: #dcf8c6;
      align-self: flex-end;
      border-bottom-right-radius: 0;
    }

    .options {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 5px;
      margin-bottom: 10px;
    }

    .option-btn {
      background-color: #075e54;
      color: white;
      border: none;
      border-radius: 15px;
      padding: 8px 12px;
      font-size: 13px;
      cursor: pointer;
      white-space: nowrap;
    }

    .option-btn:hover {
      background-color: #054a42;
    }

    .action-btn {
      width: 90%;
      padding: 12px;
      border: none;
      border-radius: 20px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      margin: 8px auto;
      display: block;
    }

    .whatsapp-btn { background-color: #25D366; color: white; }
    .reset-btn { background-color: #ff6b6b; color: white; }
    .confirm-btn { background-color: #3498db; color: white; }
    .edit-btn { background-color: #9b59b6; color: white; }

    .whatsapp-btn:hover { background-color: #128C7E; }
    .reset-btn:hover { background-color: #ff5252; }
    .confirm-btn:hover { background-color: #2980b9; }
    .edit-btn:hover { background-color: #8e44ad; }

    .pedido-item {
      background-color: #f9f9f9;
      padding: 8px;
      margin: 5px 0;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 14px;
    }

    .eliminar-btn {
      background-color: #e74c3c;
      color: white;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      font-size: 12px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<div class="chat-container">
  <div class="chat-header">Asistente de Pedidos üçΩÔ∏è</div>
  <div class="chat-messages" id="chat-messages"></div>
</div>

<script>
  // Men√∫ SIN LICORES ‚Äì solo comida y bebidas sin alcohol
  const menu = {
    asados: [
      { nombre: "Costilla de cerdo", precio: 300, tiempo: 40 },
      { nombre: "Pollo asado", precio: 220, tiempo: 35 },
      { nombre: "Cerdo asado", precio: 220, tiempo: 35 },
      { nombre: "Coraz√≥n asado", precio: 220, tiempo: 40 },
      { nombre: "Gonces asados", precio: 450, tiempo: 45 },
      { nombre: "Lomo de costilla (asado)", precio: 470, tiempo: 45 }
    ],
    mariscos: [
      { nombre: "Camarones a la plancha", precio: 370, tiempo: 35 },
      { nombre: "Camarones empanizados", precio: 370, tiempo: 40 },
      { nombre: "Camarones al ajillo", precio: 370, tiempo: 35 },
      { nombre: "Corvina a la plancha", precio: 370, tiempo: 35 }
    ],
    pollo: [
      { nombre: "Pollo a la plancha", precio: 350, tiempo: 35 },
      { nombre: "Pollo al vino", precio: 350, tiempo: 40 },
      { nombre: "Pollo jalape√±o", precio: 350, tiempo: 40 },
      { nombre: "Pollo a la plancha (T/Boca)", precio: 400, tiempo: 45 }
    ],
    extras: [
      { nombre: "Arroz o gallo pinto", precio: 50, tiempo: 5 },
      { nombre: "Papas", precio: 200, tiempo: 10 },
      { nombre: "Ensalada", precio: 40, tiempo: 3 },
      { nombre: "Tostones", precio: 50, tiempo: 8 },
      { nombre: "Jalape√±o", precio: 40, tiempo: 2 },
      { nombre: "Queso", precio: 50, tiempo: 2 }
    ],
    bebidas: [
      { nombre: "Limonada", precio: 40, tiempo: 2 },
      { nombre: "Gaseosa", precio: 30, tiempo: 2 },
      { nombre: "T√© de lim√≥n", precio: 40, tiempo: 3 },
      { nombre: "Jugo de naranja", precio: 40, tiempo: 3 },
      { nombre: "Agua embotellada", precio: 40, tiempo: 1 }
    ]
  };

  let pedido = [];
  let nombreCliente = '';
  let tipoPedido = '';
  let direccion = '';
  let instrucciones = '';

  function addMessage(text, sender = 'bot') {
    const chat = document.getElementById('chat-messages');
    const msgDiv = document.createElement('div');
    msgDiv.classList.add('message', sender);
    msgDiv.innerHTML = text.replace(/\n/g, '<br>');
    chat.appendChild(msgDiv);
    chat.scrollTop = chat.scrollHeight;
  }

  function addOptions(options, callback) {
    const chat = document.getElementById('chat-messages');
    const optsDiv = document.createElement('div');
    optsDiv.classList.add('options');
    options.forEach(opt => {
      const btn = document.createElement('button');
      btn.classList.add('option-btn');
      btn.textContent = opt;
      btn.onclick = () => {
        callback(opt);
        optsDiv.remove();
      };
      optsDiv.appendChild(btn);
    });
    chat.appendChild(optsDiv);
    chat.scrollTop = chat.scrollHeight;
  }

  function addResetButton() {
    const chat = document.getElementById('chat-messages');
    const btn = document.createElement('button');
    btn.classList.add('reset-btn');
    btn.textContent = "üîÑ Reiniciar pedido";
    btn.onclick = reiniciarPedido;
    chat.appendChild(btn);
  }

  function reiniciarPedido() {
    pedido = [];
    nombreCliente = '';
    tipoPedido = '';
    direccion = '';
    instrucciones = '';
    document.getElementById('chat-messages').innerHTML = '';
    iniciarFlujo();
  }

  function iniciarFlujo() {
    nombreCliente = prompt("¬°Hola! üëã ¬øC√≥mo te llamas?");
    if (!nombreCliente || !nombreCliente.trim()) return iniciarFlujo();
    nombreCliente = nombreCliente.trim();

    const tipo = prompt(`Hola, ${nombreCliente}!\n¬øTu pedido es para llevar o delivery? (Escribe 'para llevar' o 'delivery')`);
    if (!tipo || !['para llevar', 'delivery'].includes(tipo.toLowerCase().trim())) return iniciarFlujo();
    tipoPedido = tipo.toLowerCase().trim();

    if (tipoPedido === 'delivery') {
      direccion = prompt("Por favor, ind√≠canos tu direcci√≥n de entrega:");
      if (!direccion || !direccion.trim()) return iniciarFlujo();
      direccion = direccion.trim();
    }

    mostrarMenu();
    addResetButton();
  }

  function mostrarMenu() {
    addMessage("¬øQu√© te gustar√≠a pedir?");
    // ‚ö†Ô∏è Se elimin√≥ "Cervezas/Licores" de las opciones
    addOptions(
      ["Asados", "Mariscos", "Pollo", "Extras", "Bebidas", "Ver/Editar pedido", "Enviar pedido"],
      manejarCategoria
    );
  }

  function manejarCategoria(categoria) {
    addMessage(categoria, 'user');

    if (categoria === "Ver/Editar pedido") {
      mostrarPedidoEditable();
      return;
    }

    if (categoria === "Enviar pedido") {
      if (pedido.length === 0) {
        addMessage("No has agregado nada a tu pedido. üòï");
        mostrarMenu();
        return;
      }
      solicitarInstrucciones();
      return;
    }

    // Mapeo de categor√≠as (sin cervezas/licores)
    const catKey = 
      categoria === "Asados" ? 'asados' :
      categoria === "Mariscos" ? 'mariscos' :
      categoria === "Pollo" ? 'pollo' :
      categoria === "Extras" ? 'extras' :
      categoria === "Bebidas" ? 'bebidas' : null;

    if (!catKey || !menu[catKey]) {
      addMessage("Categor√≠a no v√°lida.");
      mostrarMenu();
      return;
    }

    const items = menu[catKey];
    const nombres = items.map(i => i.nombre);
    addMessage(`Selecciona un √≠tem de ${categoria}:`);
    addOptions(nombres, (nombre) => {
      const item = items.find(i => i.nombre === nombre);
      if (item) {
        pedido.push(item);
        addMessage(`‚úÖ Agregado: ${nombre} - C$${item.precio}`, 'user');
      }
      mostrarMenu();
    });
  }

  function mostrarPedidoEditable() {
    if (pedido.length === 0) {
      addMessage("Tu pedido est√° vac√≠o. üò¢");
      mostrarMenu();
      return;
    }

    const chat = document.getElementById('chat-messages');
    const resumenDiv = document.createElement('div');
    resumenDiv.innerHTML = "<strong>Tu pedido:</strong>";
    
    pedido.forEach((item, index) => {
      const itemDiv = document.createElement('div');
      itemDiv.classList.add('pedido-item');
      itemDiv.innerHTML = `
        ${item.nombre} - C$${item.precio}
        <button class="eliminar-btn" data-index="${index}">üóëÔ∏è</button>
      `;
      resumenDiv.appendChild(itemDiv);
    });

    let total = pedido.reduce((sum, item) => sum + item.precio, 0);
    let maxTiempo = Math.max(...pedido.map(item => item.tiempo));
    resumenDiv.innerHTML += `<div style="margin-top:10px;"><strong>üí∞ Total: C$${total}</strong><br><strong>üïí Tiempo: ${maxTiempo} min</strong></div>`;

    chat.appendChild(resumenDiv);

    document.querySelectorAll('.eliminar-btn').forEach(btn => {
      btn.onclick = () => {
        const index = parseInt(btn.getAttribute('data-index'));
        pedido.splice(index, 1);
        chat.removeChild(resumenDiv);
        addMessage("√çtem eliminado. ‚úÖ");
        mostrarMenu();
      };
    });

    addOptions(["Seguir pidiendo", "Enviar pedido"], (opt) => {
      if (opt === "Enviar pedido") {
        if (pedido.length === 0) {
          addMessage("No hay √≠tems en tu pedido.");
          mostrarMenu();
        } else {
          solicitarInstrucciones();
        }
      } else {
        mostrarMenu();
      }
    });
  }

  function solicitarInstrucciones() {
    instrucciones = prompt("¬øAlguna instrucci√≥n especial? (Ej: 'sin picante', 'dejar en port√≥n')\nDeja en blanco si no aplica:") || "";
    mostrarResumenFinal();
  }

  function mostrarResumenFinal() {
    let total = pedido.reduce((sum, item) => sum + item.precio, 0);
    let maxTiempo = Math.max(...pedido.map(item => item.tiempo));

    let resumen = `üë§ *Nombre:* ${nombreCliente}\n`;
    resumen += `üì¶ *Tipo:* ${tipoPedido.charAt(0).toUpperCase() + tipoPedido.slice(1)}\n`;
    if (tipoPedido === 'delivery') resumen += `üìç *Direcci√≥n:* ${direccion}\n`;
    if (instrucciones) resumen += `üìù *Instrucciones:* ${instrucciones}\n`;
    resumen += `\nüìã *Pedido:*\n`;
    pedido.forEach(item => {
      resumen += `‚Ä¢ ${item.nombre} - C$${item.precio}\n`;
    });
    resumen += `\nüí∞ *Total estimado:* C$${total}\n`;
    resumen += `üïí *Tiempo estimado:* ${maxTiempo} minutos\n\n`;
    resumen += `¬øEnviar este pedido?`;

    addMessage(resumen);
    
    const chat = document.getElementById('chat-messages');
    const btn = document.createElement('button');
    btn.classList.add('confirm-btn');
    btn.textContent = "‚úÖ S√≠, enviar pedido";
    btn.onclick = enviarPedido;
    chat.appendChild(btn);
  }

  function enviarPedido() {
    let total = pedido.reduce((sum, item) => sum + item.precio, 0);
    let maxTiempo = Math.max(...pedido.map(item => item.tiempo));

    let mensaje = `Hola, quiero hacer un pedido:\n`;
    mensaje += `Nombre: ${nombreCliente}\n`;
    mensaje += `Tipo: ${tipoPedido}\n`;
    if (tipoPedido === 'delivery') mensaje += `Direcci√≥n: ${direccion}\n`;
    if (instrucciones) mensaje += `Instrucciones: ${instrucciones}\n`;
    mensaje += `\nPedido:\n`;
    pedido.forEach(item => {
      mensaje += `‚Ä¢ ${item.nombre} - C$${item.precio}\n`;
    });
    mensaje += `\nTotal estimado: C$${total}\n`;
    mensaje += `Tiempo estimado: ${maxTiempo} minutos\n`;
    mensaje += `¬°Gracias!`;

    const url = `https://wa.me/50584751878?text=${encodeURIComponent(mensaje)}`;
    window.open(url, '_blank');

    addMessage("¬°Pedido enviado! üéâ\nTe contactaremos pronto por WhatsApp.");
    addMessage("¬øQuieres hacer otro pedido?");
    addOptions(["S√≠", "No"], (r) => {
      if (r === "S√≠") reiniciarPedido();
      else addMessage("¬°Gracias por tu preferencia! üôå");
    });
  }

  window.onload = () => {
    iniciarFlujo();
  };
</script>

</body>
</html>